<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NAO Virtual Storyteller: qnn.preprocess Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NAO Virtual Storyteller
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespaceqnn.html">qnn</a></li><li class="navelem"><a class="el" href="namespaceqnn_1_1preprocess.html">preprocess</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">qnn.preprocess Namespace Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classqnn_1_1preprocess_1_1InputOutputNameMap.html">InputOutputNameMap</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a4165c596f92fd6c43f734b7ab0e46466"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceqnn_1_1preprocess.html#a4165c596f92fd6c43f734b7ab0e46466">qnn_preprocess_model</a> (str|Path|onnx.ModelProto model_input, str|Path model_output, bool fuse_layernorm=False, bool save_as_external_data=False, bool all_tensors_to_one_file=False, str|None external_data_location=None, int external_data_size_threshold=1024, bool external_data_convert_attribute=False, list[str]|None inputs_to_make_channel_last=None, list[str]|None outputs_to_make_channel_last=None)</td></tr>
<tr class="separator:a4165c596f92fd6c43f734b7ab0e46466"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af9071ee396d99db3cf42818e5e56ddf2"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceqnn_1_1preprocess.html#af9071ee396d99db3cf42818e5e56ddf2">update_io_to_channel_last</a> (onnx.ModelProto model, list[str]|None inputs_to_update, list[str]|None outputs_to_update, str transpose_node_name_prefix=&quot;Transpose_channel_&quot;, int transpose_node_name_start_suffix=0)</td></tr>
<tr class="separator:af9071ee396d99db3cf42818e5e56ddf2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a4165c596f92fd6c43f734b7ab0e46466"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4165c596f92fd6c43f734b7ab0e46466">&#9670;&nbsp;</a></span>qnn_preprocess_model()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool qnn.preprocess.qnn_preprocess_model </td>
          <td>(</td>
          <td class="paramtype">str | Path | onnx.ModelProto&#160;</td>
          <td class="paramname"><em>model_input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">str | Path&#160;</td>
          <td class="paramname"><em>model_output</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool &#160;</td>
          <td class="paramname"><em>fuse_layernorm</em> = <code>False</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool &#160;</td>
          <td class="paramname"><em>save_as_external_data</em> = <code>False</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool &#160;</td>
          <td class="paramname"><em>all_tensors_to_one_file</em> = <code>False</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">str | None &#160;</td>
          <td class="paramname"><em>external_data_location</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int &#160;</td>
          <td class="paramname"><em>external_data_size_threshold</em> = <code>1024</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool &#160;</td>
          <td class="paramname"><em>external_data_convert_attribute</em> = <code>False</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">list[str] | None &#160;</td>
          <td class="paramname"><em>inputs_to_make_channel_last</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">list[str] | None &#160;</td>
          <td class="paramname"><em>outputs_to_make_channel_last</em> = <code>None</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">If necessary, this method creates a new "pre-processed" model in preparation for
quantization of a model to be used in QNN EP. Returns true if a new model was created.

This method perfoms the following operations:
- Fuse Erf sequence into a single Gelu node.
- Fuse ReduceL2 sequence into a single LpNormalization node (p == 2).
- (Optional) Fuse ReduceMean sequence into a single LayerNormalization node.

Args:
    model_input: Path to the input model file or ModelProto.
    model_output: Path the output model file, which is only created if this method returns True.
    fuse_layernorm: True if ReduceMean sequences should be fused into LayerNormalization nodes.
        Defaults to False.
    save_as_external_data: True if output model should be saved with external data. Defaults to false.
    all_tensors_to_one_file: Effective only if save_as_external_data is true. Defaults to false.
        If true, save all tensors to one external file specified by external_data_location.
        If false, save each tensor to a file named with the tensor name.
    external_data_location: Effective only if save_as_external_data is true. Defaults to None.
        Specify the external file to which all tensors are saved. Path is relative
        to the model path. If not specified, the model's name is used.
    external_data_size_threshold: Effective only if save_as_external_data is true. Defaults to 1024.
        Tensors with a data size &gt;= external_data_size_threshold are converted to external data.
        To convert every tensor with raw data to external data, set to 0.
    external_data_convert_attribute: Effective only if save_as_external_data is true. Defaults to false.
        If true, convert all tensors to external data.
        If false, convert only non-attribute tensors to external data.
    inputs_to_make_channel_last: List of graph input names to transpose to be "channel-last". For example,
        if "input0" originally has the shape (N, C, D1, D2, ..., Dn), the resulting model will change input0's
        shape to (N, D1, D2, ..., Dn, C) and add a transpose node after it.

        Original:
            input0 (N, C, D1, D2, ..., Dn) --&gt; &lt;Nodes&gt;

        Updated:
            input0 (N, D1, D2, ..., Dn, C) --&gt; Transpose --&gt; input0_chanfirst (N, C, D1, D2, ..., Dn) --&gt; &lt;Nodes&gt;

        This can potentially improve inference latency for QDQ models running on QNN EP because the
        additional transpose node may allow other transpose nodes inserted during ORT layout transformation
        to cancel out.
    outputs_to_make_channel_last: List of graph output names to transpose to be "channel-last". For example,
        if "output0" originally has the shape (N, C, D1, D2, ..., Dn), the resulting model will change output0's
        shape to (N, D1, D2, ..., Dn, C) and add a transpose node before it.

        Original:
            &lt;Nodes&gt; --&gt; output0 (N, C, D1, D2, ..., Dn)

        Updated:
            &lt;Nodes&gt; --&gt; output0_chanfirst (N, C, D1, D2, ..., Dn) --&gt; Transpose --&gt; output0 (N, D1, D2, ..., Dn, C)

        This can potentially improve inference latency for QDQ models running on QNN EP because the
        additional transpose node may allow other transpose nodes inserted during ORT layout transformation
        to cancel out.
</pre> 
</div>
</div>
<a id="af9071ee396d99db3cf42818e5e56ddf2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af9071ee396d99db3cf42818e5e56ddf2">&#9670;&nbsp;</a></span>update_io_to_channel_last()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def qnn.preprocess.update_io_to_channel_last </td>
          <td>(</td>
          <td class="paramtype">onnx.ModelProto&#160;</td>
          <td class="paramname"><em>model</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">list[str] | None&#160;</td>
          <td class="paramname"><em>inputs_to_update</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">list[str] | None&#160;</td>
          <td class="paramname"><em>outputs_to_update</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">str &#160;</td>
          <td class="paramname"><em>transpose_node_name_prefix</em> = <code>&quot;Transpose_channel_&quot;</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int &#160;</td>
          <td class="paramname"><em>transpose_node_name_start_suffix</em> = <code>0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
