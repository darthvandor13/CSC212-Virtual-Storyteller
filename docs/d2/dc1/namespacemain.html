<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AI Storyteller: main Namespace Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AI Storyteller
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('d2/dc1/namespacemain.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">main Namespace Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/dd3/classmain_1_1DialogflowParameters.html">DialogflowParameters</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/df3/classmain_1_1DialogflowSessionInfo.html">DialogflowSessionInfo</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d26/classmain_1_1DialogflowWebhookRequest.html">DialogflowWebhookRequest</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a75812e85849cf346c3cd9ed099b58498"><td class="memItemLeft" align="right" valign="top">Optional[chromadb.api.models.Collection.Collection]&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/dc1/namespacemain.html#a75812e85849cf346c3cd9ed099b58498">create_chroma_collection</a> (<a class="el" href="../../d2/dc1/namespacemain.html#a26f656d825a0ffd09a95f3e7953445e5">str</a> <a class="el" href="../../d2/dc1/namespacemain.html#a0cf58d9b4a444874a8cf80fdf162b0fb">host</a>, <a class="el" href="../../d2/dc1/namespacemain.html#af65ea1f7cf2ee4911befba82862a89dc">int</a> <a class="el" href="../../d2/dc1/namespacemain.html#a12fac67ac230690557ab76d3faa71d8c">port</a>, <a class="el" href="../../d2/dc1/namespacemain.html#a26f656d825a0ffd09a95f3e7953445e5">str</a> name)</td></tr>
<tr class="separator:a75812e85849cf346c3cd9ed099b58498"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a512f8c221a901675d84f9c813321f2ee"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d2/dc1/namespacemain.html#a26f656d825a0ffd09a95f3e7953445e5">str</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/dc1/namespacemain.html#a512f8c221a901675d84f9c813321f2ee">build_query_string</a> (<a class="el" href="../../d2/dc1/namespacemain.html#a26f656d825a0ffd09a95f3e7953445e5">str</a> protagonist, <a class="el" href="../../d2/dc1/namespacemain.html#a26f656d825a0ffd09a95f3e7953445e5">str</a> theme, <a class="el" href="../../d2/dc1/namespacemain.html#a26f656d825a0ffd09a95f3e7953445e5">str</a> moral)</td></tr>
<tr class="separator:a512f8c221a901675d84f9c813321f2ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f471be739ad11c03bae4d44c8a32d43"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d2/dc1/namespacemain.html#a26f656d825a0ffd09a95f3e7953445e5">str</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/dc1/namespacemain.html#a6f471be739ad11c03bae4d44c8a32d43">search_stories</a> (chromadb.api.models.Collection.Collection collection, <a class="el" href="../../d2/dc1/namespacemain.html#a26f656d825a0ffd09a95f3e7953445e5">str</a> query, <a class="el" href="../../d2/dc1/namespacemain.html#af65ea1f7cf2ee4911befba82862a89dc">int</a> n_results=DEFAULT_N_RESULTS)</td></tr>
<tr class="separator:a6f471be739ad11c03bae4d44c8a32d43"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad7710bdb0c31032acf6c50ec97aee588"><td class="memItemLeft" align="right" valign="top">Dict[<a class="el" href="../../d2/dc1/namespacemain.html#a26f656d825a0ffd09a95f3e7953445e5">str</a>, Any]&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/dc1/namespacemain.html#ad7710bdb0c31032acf6c50ec97aee588">format_dialogflow_error_response</a> (<a class="el" href="../../d2/dc1/namespacemain.html#a26f656d825a0ffd09a95f3e7953445e5">str</a> message)</td></tr>
<tr class="separator:ad7710bdb0c31032acf6c50ec97aee588"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae10d8b25755a7aadb5933274b6c50307"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/dc1/namespacemain.html#ae10d8b25755a7aadb5933274b6c50307">startup_event</a> ()</td></tr>
<tr class="separator:ae10d8b25755a7aadb5933274b6c50307"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0dce9941b6e9b45a6cacd8b0ce5f385d"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/dc1/namespacemain.html#a0dce9941b6e9b45a6cacd8b0ce5f385d">query_endpoint</a> (<a class="el" href="../../dd/d26/classmain_1_1DialogflowWebhookRequest.html">DialogflowWebhookRequest</a> request)</td></tr>
<tr class="separator:a0dce9941b6e9b45a6cacd8b0ce5f385d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab79a122a5bdf3e941b4605f7020e3dc3"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/dc1/namespacemain.html#ab79a122a5bdf3e941b4605f7020e3dc3">main</a> (FlaskRequest request)</td></tr>
<tr class="memdesc:ab79a122a5bdf3e941b4605f7020e3dc3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Main entry point for the Google Cloud Function.  <a href="../../d2/dc1/namespacemain.html#ab79a122a5bdf3e941b4605f7020e3dc3">More...</a><br /></td></tr>
<tr class="separator:ab79a122a5bdf3e941b4605f7020e3dc3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a26f656d825a0ffd09a95f3e7953445e5"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/dc1/namespacemain.html#a26f656d825a0ffd09a95f3e7953445e5">str</a></td></tr>
<tr class="separator:a26f656d825a0ffd09a95f3e7953445e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af65ea1f7cf2ee4911befba82862a89dc"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/dc1/namespacemain.html#af65ea1f7cf2ee4911befba82862a89dc">int</a></td></tr>
<tr class="separator:af65ea1f7cf2ee4911befba82862a89dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5fa94f0581009434c7a63791944d6ff4"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/dc1/namespacemain.html#a5fa94f0581009434c7a63791944d6ff4">app</a></td></tr>
<tr class="separator:a5fa94f0581009434c7a63791944d6ff4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4c48b44a1e8e7c372b0ba1ae27308f6a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/dc1/namespacemain.html#a4c48b44a1e8e7c372b0ba1ae27308f6a">server_port</a> = <a class="el" href="../../d2/dc1/namespacemain.html#af65ea1f7cf2ee4911befba82862a89dc">int</a>(os.getenv(&quot;PORT&quot;, &quot;8080&quot;))</td></tr>
<tr class="separator:a4c48b44a1e8e7c372b0ba1ae27308f6a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0cf58d9b4a444874a8cf80fdf162b0fb"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/dc1/namespacemain.html#a0cf58d9b4a444874a8cf80fdf162b0fb">host</a></td></tr>
<tr class="separator:a0cf58d9b4a444874a8cf80fdf162b0fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a12fac67ac230690557ab76d3faa71d8c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/dc1/namespacemain.html#a12fac67ac230690557ab76d3faa71d8c">port</a></td></tr>
<tr class="separator:a12fac67ac230690557ab76d3faa71d8c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af5c322ab299aa203b2c0f9c76a76c5c2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/dc1/namespacemain.html#af5c322ab299aa203b2c0f9c76a76c5c2">reload</a></td></tr>
<tr class="separator:af5c322ab299aa203b2c0f9c76a76c5c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a30c9339bc9ecae310c9f7d769dfbf159"><td class="memItemLeft" align="right" valign="top">string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/dc1/namespacemain.html#a30c9339bc9ecae310c9f7d769dfbf159">CHROMA_DB_HOST</a> = &quot;http://34.118.162.201:8000&quot;</td></tr>
<tr class="memdesc:a30c9339bc9ecae310c9f7d769dfbf159"><td class="mdescLeft">&#160;</td><td class="mdescRight">The base URL (including http/https) of the ChromaDB HTTP API server.  <a href="../../d2/dc1/namespacemain.html#a30c9339bc9ecae310c9f7d769dfbf159">More...</a><br /></td></tr>
<tr class="separator:a30c9339bc9ecae310c9f7d769dfbf159"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a201fed8be15d6f38658f1b925638190a"><td class="memItemLeft" align="right" valign="top">string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/dc1/namespacemain.html#a201fed8be15d6f38658f1b925638190a">COLLECTION_NAME</a> = &quot;stories&quot;</td></tr>
<tr class="memdesc:a201fed8be15d6f38658f1b925638190a"><td class="mdescLeft">&#160;</td><td class="mdescRight">The name of the ChromaDB collection to be queried.  <a href="../../d2/dc1/namespacemain.html#a201fed8be15d6f38658f1b925638190a">More...</a><br /></td></tr>
<tr class="separator:a201fed8be15d6f38658f1b925638190a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d5140030336c5e6df9d59dbd2f11621"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d2/dc1/namespacemain.html#af65ea1f7cf2ee4911befba82862a89dc">int</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/dc1/namespacemain.html#a8d5140030336c5e6df9d59dbd2f11621">REQUEST_TIMEOUT</a> = 10</td></tr>
<tr class="memdesc:a8d5140030336c5e6df9d59dbd2f11621"><td class="mdescLeft">&#160;</td><td class="mdescRight">Timeout in seconds for the HTTP request to the ChromaDB API.  <a href="../../d2/dc1/namespacemain.html#a8d5140030336c5e6df9d59dbd2f11621">More...</a><br /></td></tr>
<tr class="separator:a8d5140030336c5e6df9d59dbd2f11621"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a512f8c221a901675d84f9c813321f2ee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a512f8c221a901675d84f9c813321f2ee">&#9670;&nbsp;</a></span>build_query_string()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"> <a class="el" href="../../d2/dc1/namespacemain.html#a26f656d825a0ffd09a95f3e7953445e5">str</a> main.build_query_string </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d2/dc1/namespacemain.html#a26f656d825a0ffd09a95f3e7953445e5">str</a>&#160;</td>
          <td class="paramname"><em>protagonist</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d2/dc1/namespacemain.html#a26f656d825a0ffd09a95f3e7953445e5">str</a>&#160;</td>
          <td class="paramname"><em>theme</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d2/dc1/namespacemain.html#a26f656d825a0ffd09a95f3e7953445e5">str</a>&#160;</td>
          <td class="paramname"><em>moral</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Concatenates protagonist, theme, and moral into a single search string.
Only non-empty parts are joined. Whitespace is trimmed.

@param protagonist The protagonist of the story.
@param theme The main theme of the story.
@param moral The moral or lesson of the story.
@return A concatenated query string.
</pre> 
</div>
</div>
<a id="a75812e85849cf346c3cd9ed099b58498"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a75812e85849cf346c3cd9ed099b58498">&#9670;&nbsp;</a></span>create_chroma_collection()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"> Optional[chromadb.api.models.Collection.Collection] main.create_chroma_collection </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d2/dc1/namespacemain.html#a26f656d825a0ffd09a95f3e7953445e5">str</a>&#160;</td>
          <td class="paramname"><em>host</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d2/dc1/namespacemain.html#af65ea1f7cf2ee4911befba82862a89dc">int</a>&#160;</td>
          <td class="paramname"><em>port</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d2/dc1/namespacemain.html#a26f656d825a0ffd09a95f3e7953445e5">str</a>&#160;</td>
          <td class="paramname"><em>name</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Attempts to connect to ChromaDB and retrieve the specified collection.

@param host The hostname or IP address of the ChromaDB server.
@param port The port number of the ChromaDB server.
@param name The name of the collection to retrieve.
@return The ChromaDB collection object if successful, None otherwise.
</pre> 
</div>
</div>
<a id="ad7710bdb0c31032acf6c50ec97aee588"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad7710bdb0c31032acf6c50ec97aee588">&#9670;&nbsp;</a></span>format_dialogflow_error_response()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"> Dict[<a class="el" href="../../d2/dc1/namespacemain.html#a26f656d825a0ffd09a95f3e7953445e5">str</a>, Any] main.format_dialogflow_error_response </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d2/dc1/namespacemain.html#a26f656d825a0ffd09a95f3e7953445e5">str</a>&#160;</td>
          <td class="paramname"><em>message</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Formats an error message into the JSON structure expected by Dialogflow CX
for a fulfillment response.

@param message The error message text to be sent to the user.
@return A dictionary representing the Dialogflow CX error response.
</pre> 
</div>
</div>
<a id="ab79a122a5bdf3e941b4605f7020e3dc3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab79a122a5bdf3e941b4605f7020e3dc3">&#9670;&nbsp;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def main.main </td>
          <td>(</td>
          <td class="paramtype">FlaskRequest&#160;</td>
          <td class="paramname"><em>request</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Main entry point for the Google Cloud Function. </p>
<p>This function is triggered by an HTTP request. It expects a JSON payload from Dialogflow CX, extracts the user's query text, queries the ChromaDB HTTP API, and formats the search results or error messages into a JSON response suitable for Dialogflow's <code>fulfillmentText</code>. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">request</td><td>flask.Request The incoming HTTP request object from Google Cloud Functions. It's expected to contain a JSON payload, typically from Dialogflow CX, with the user's query located at <code>queryResult.queryText</code>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>flask.Response A JSON response object suitable for Dialogflow fulfillment. The JSON object will have a key <code>fulfillmentText</code> containing the response string. </dd></dl>
<dl class="section note"><dt>Note</dt><dd>This function handles various potential errors during its execution, such as issues with the incoming payload, ChromaDB API errors (HTTP errors, timeouts), and problems parsing the ChromaDB response. Error messages are user-friendly.</dd></dl>
<pre class="fragment">Handles incoming Dialogflow CX webhook requests, queries ChromaDB via HTTP,
and returns a formatted response.
</pre> 
</div>
</div>
<a id="a0dce9941b6e9b45a6cacd8b0ce5f385d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0dce9941b6e9b45a6cacd8b0ce5f385d">&#9670;&nbsp;</a></span>query_endpoint()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def main.query_endpoint </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dd/d26/classmain_1_1DialogflowWebhookRequest.html">DialogflowWebhookRequest</a>&#160;</td>
          <td class="paramname"><em>request</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Handles POST requests to the /query endpoint.
Extracts story parameters from the Dialogflow webhook request (parsed by Pydantic),
queries ChromaDB, and returns a story snippet or an error message
formatted for Dialogflow CX.

@param request The incoming Dialogflow webhook request.
@return A JSON response suitable for Dialogflow CX.
</pre> 
</div>
</div>
<a id="a6f471be739ad11c03bae4d44c8a32d43"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6f471be739ad11c03bae4d44c8a32d43">&#9670;&nbsp;</a></span>search_stories()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"> <a class="el" href="../../d2/dc1/namespacemain.html#a26f656d825a0ffd09a95f3e7953445e5">str</a> main.search_stories </td>
          <td>(</td>
          <td class="paramtype">chromadb.api.models.Collection.Collection&#160;</td>
          <td class="paramname"><em>collection</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d2/dc1/namespacemain.html#a26f656d825a0ffd09a95f3e7953445e5">str</a>&#160;</td>
          <td class="paramname"><em>query</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d2/dc1/namespacemain.html#af65ea1f7cf2ee4911befba82862a89dc">int</a> &#160;</td>
          <td class="paramname"><em>n_results</em> = <code>DEFAULT_N_RESULTS</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Queries the ChromaDB collection and returns a merged snippet of story documents
or a user-facing fallback message if no relevant stories are found or an error occurs.

@param collection The ChromaDB collection object to query.
@param query The query string to search for.
@param n_results The number of results to retrieve from ChromaDB.
@return A string containing merged story snippets or a user-facing fallback/error message.
</pre> 
</div>
</div>
<a id="ae10d8b25755a7aadb5933274b6c50307"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae10d8b25755a7aadb5933274b6c50307">&#9670;&nbsp;</a></span>startup_event()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def main.startup_event </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Application startup event handler.
Initializes the connection to ChromaDB and retrieves the collection.
</pre> 
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a5fa94f0581009434c7a63791944d6ff4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5fa94f0581009434c7a63791944d6ff4">&#9670;&nbsp;</a></span>app</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">main.app</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;=  FastAPI(</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;    title=<span class="stringliteral">&quot;ChromaDB Story Search API for Dialogflow&quot;</span>,</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    description=<span class="stringliteral">&quot;Exposes an endpoint to search for story snippets in ChromaDB based on Dialogflow parameters.&quot;</span>,</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    version=<span class="stringliteral">&quot;1.1.0&quot;</span> <span class="comment"># Incremented version</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;)</div>
</div><!-- fragment -->
</div>
</div>
<a id="a30c9339bc9ecae310c9f7d769dfbf159"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a30c9339bc9ecae310c9f7d769dfbf159">&#9670;&nbsp;</a></span>CHROMA_DB_HOST</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">main.CHROMA_DB_HOST = &quot;http://34.118.162.201:8000&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The base URL (including http/https) of the ChromaDB HTTP API server. </p>
<p>Example: "http://&lt;your-chroma-db-ip-or-domain&gt;:&lt;port&gt;" </p>

</div>
</div>
<a id="a201fed8be15d6f38658f1b925638190a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a201fed8be15d6f38658f1b925638190a">&#9670;&nbsp;</a></span>COLLECTION_NAME</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">main.COLLECTION_NAME = &quot;stories&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The name of the ChromaDB collection to be queried. </p>

</div>
</div>
<a id="a0cf58d9b4a444874a8cf80fdf162b0fb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0cf58d9b4a444874a8cf80fdf162b0fb">&#9670;&nbsp;</a></span>host</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">main.host</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="af65ea1f7cf2ee4911befba82862a89dc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af65ea1f7cf2ee4911befba82862a89dc">&#9670;&nbsp;</a></span>int</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">main.int</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a12fac67ac230690557ab76d3faa71d8c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a12fac67ac230690557ab76d3faa71d8c">&#9670;&nbsp;</a></span>port</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">main.port</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="af5c322ab299aa203b2c0f9c76a76c5c2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af5c322ab299aa203b2c0f9c76a76c5c2">&#9670;&nbsp;</a></span>reload</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">main.reload</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a8d5140030336c5e6df9d59dbd2f11621"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8d5140030336c5e6df9d59dbd2f11621">&#9670;&nbsp;</a></span>REQUEST_TIMEOUT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">main.REQUEST_TIMEOUT = 10</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Timeout in seconds for the HTTP request to the ChromaDB API. </p>

</div>
</div>
<a id="a4c48b44a1e8e7c372b0ba1ae27308f6a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4c48b44a1e8e7c372b0ba1ae27308f6a">&#9670;&nbsp;</a></span>server_port</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">main.server_port = <a class="el" href="../../d2/dc1/namespacemain.html#af65ea1f7cf2ee4911befba82862a89dc">int</a>(os.getenv(&quot;PORT&quot;, &quot;8080&quot;))</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a26f656d825a0ffd09a95f3e7953445e5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a26f656d825a0ffd09a95f3e7953445e5">&#9670;&nbsp;</a></span>str</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">main.str</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../d2/dc1/namespacemain.html">main</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
